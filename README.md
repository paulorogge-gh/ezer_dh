# üß† Ezer Desenvolvimento Humano

**Ezer Desenvolvimento Humano (Ezer DH)** √© uma plataforma web voltada para **gest√£o de pessoas, performance e desenvolvimento humano**. A solu√ß√£o √© oferecida para empresas clientes por meio de uma **consultoria especializada**.

O sistema permite gerenciar empresas, colaboradores, departamentos, ocorr√™ncias, feedbacks, treinamentos e avalia√ß√µes de desempenho (90¬∞, 180¬∞, 360¬∞), oferecendo uma vis√£o completa da evolu√ß√£o e comportamento dos profissionais.

---

## üèóÔ∏è Vis√£o geral do projeto

O **Ezer DH** √© uma aplica√ß√£o web modular composta por um **backend em Node.js (API e regras de neg√≥cio)** e um **frontend em HTML/CSS/Bootstrap**, integrados a um banco de dados **MySQL**.

### üéØ Objetivo

Automatizar e centralizar processos de **gest√£o de pessoas** e **avalia√ß√£o de desempenho** para consultorias e empresas clientes, com controle de acesso hier√°rquico e indicadores de performance.

---

## üåê Configura√ß√£o de Portas

| Servi√ßo | Porta | URL | Descri√ß√£o |
|---------|-------|-----|-----------|
| **Frontend** | 3000 | http://localhost:3000 | Interface web do usu√°rio |
| **Backend API** | 3001 | http://localhost:3001 | API REST e autentica√ß√£o |
| **Health Check** | 3001 | http://localhost:3001/api/health | Verifica√ß√£o de status |

### üöÄ Como iniciar o projeto:
```bash
# Iniciar ambos os servidores
./start.sh

# Ou iniciar separadamente:
# Backend (porta 3001)
cd backend && npm start

# Frontend (porta 3000)  
cd frontend && npm start
```

---

## üß© Funcionalidades principais

### 1. Gest√£o de empresas (clientes)
- Cadastro de empresas (clientes da consultoria).
- Vincula√ß√£o de departamentos e colaboradores.
- Controle de acesso por empresa.

### 2. Gest√£o de colaboradores
- Dados pessoais e profissionais:
  - Empresa, CPF, nome, data de nascimento, e-mails (pessoal e corporativo), telefone, departamento(s), cargo, remunera√ß√£o, data de admiss√£o.
  - Tipo de contrato: **CLT**, **Prestador de Servi√ßo**, **Estagi√°rio** ou **Jovem Aprendiz**.
- Importa√ß√£o em lote via modelo Excel.
- Um colaborador pode pertencer a **mais de um departamento**.

### 2.1. Gest√£o de L√≠deres e Liderados (novo m√≥dulo)
### 2.2. Gerenciamento de Usu√°rios (RBAC)

M√≥dulo para administra√ß√£o das contas de acesso com controle estrito por RBAC, seguindo o planejamento (RF001‚ÄìRF005, RBAC/RB). Permite consultar/criar/atualizar/excluir usu√°rios com tipos: `consultoria`, `empresa`, `colaborador`.

Banco:
- Tabela `usuario` (j√° existente): `id_usuario`, `email` (√∫nico), `senha` (bcrypt), `tipo_usuario` (`consultoria|empresa|colaborador`), `id_referencia`, `status`, `ultimo_login`, `tentativas_login`, `bloqueado_ate`.

API:
- GET `/api/usuarios?empresa_id&tipo_usuario&status` ‚Äî Lista (consultoria: todos; empresa: escopo da pr√≥pria; colaborador: apenas pr√≥prio)
- GET `/api/usuarios/:id` ‚Äî Detalhe (restrito ao escopo)
- POST `/api/usuarios` ‚Äî Criar (consultoria/empresa)
- PUT `/api/usuarios/:id` ‚Äî Atualizar (consultoria/empresa; colaborador apenas pr√≥prio e sem alterar status)
- PATCH `/api/usuarios/:id/status` ‚Äî Alterar status (consultoria/empresa)
- POST `/api/usuarios/:id/reset-password` ‚Äî Reset de senha (consultoria/empresa)
- DELETE `/api/usuarios/:id` ‚Äî Excluir (consultoria/empresa)

RBAC:
- `consultoria`: CRUD completo em `usuarios`.
- `empresa`: CRUD em `usuarios` do seu escopo (usu√°rios tipo `empresa` da pr√≥pria e `colaborador` da pr√≥pria empresa).
- `colaborador`: leitura do pr√≥prio e atualiza√ß√£o limitada (e-mail/senha).

Frontend:
- P√°gina `frontend/public/usuarios.html` + script `frontend/public/js/usuarios.js`.
- Filtros: Empresa, Tipo, Status; busca por e-mail; a√ß√µes: criar, editar, reset de senha, alterar status, excluir.
- Navega√ß√£o adicionada na sidebar.


Este m√≥dulo permite definir l√≠deres por empresa, gerenciar seus liderados e os departamentos que supervisionam, com intera√ß√µes via modais e atualiza√ß√£o din√¢mica no frontend (fetch/AJAX), seguindo o layout minimalista existente.

- Sele√ß√£o de Empresa: filtro por empresa e controle de permiss√µes de acesso.
- Defini√ß√£o de L√≠der: um colaborador ativo da empresa pode ser definido como l√≠der.
- Gerenciamento de Liderados: adicionar/remover liderados do l√≠der.
- Gerenciamento de Departamentos: vincular/desvincular departamentos ao l√≠der.

Estrutura de banco de dados:

```
lider (id_lider PK, id_empresa FK->empresa, id_colaborador FK->colaborador, status, created_at, updated_at)
lider_membro (id_lider FK->lider, id_liderado FK->colaborador, PK composto)
lider_departamento (id_lider FK->lider, id_departamento FK->departamento, PK composto)
```

Rotas da API (todas autenticadas, respostas JSON padronizadas):

- GET `/api/lideres?empresa_id=ID&status=Ativo|Inativo` ‚Äî listar l√≠deres (opcionalmente por empresa/status)
- GET `/api/lideres/:id` ‚Äî detalhes de um l√≠der
- POST `/api/lideres` ‚Äî criar l√≠der
  - Body: `{ "id_empresa": number, "id_colaborador": number, "status": "Ativo"|"Inativo" }`
- PUT `/api/lideres/:id` ‚Äî atualizar l√≠der (status e/ou colaborador)
  - Body: `{ "id_empresa"?: number, "id_colaborador"?: number, "status"?: "Ativo"|"Inativo" }`
- DELETE `/api/lideres/:id` ‚Äî excluir l√≠der
- GET `/api/lideres/:id/membros` ‚Äî listar liderados
- POST `/api/lideres/:id/membros` ‚Äî adicionar liderado
  - Body: `{ "liderado_id": number }`
- DELETE `/api/lideres/:id/membros/:liderado_id` ‚Äî remover liderado
- GET `/api/lideres/:id/departamentos` ‚Äî listar departamentos do l√≠der
- POST `/api/lideres/:id/departamentos` ‚Äî adicionar departamento ao l√≠der
  - Body: `{ "departamento_id": number }`
- DELETE `/api/lideres/:id/departamentos/:departamento_id` ‚Äî remover departamento do l√≠der

Permiss√µes (RBAC):

- `consultoria`: create/read/update/delete em `lideres`.
- `empresa`: create/read/update/delete em `lideres` da pr√≥pria empresa.
- `colaborador`: read (leitura) onde aplic√°vel.

Frontend:

- P√°gina `frontend/public/lideres.html` e script `frontend/public/js/lideres.js`.
- Filtro por empresa, busca por nome do l√≠der, a√ß√µes na lista: Ver, Editar, Gerenciar Liderados, Gerenciar Departamentos, Excluir.
- Modais:
  - Novo L√≠der: sele√ß√£o de empresa e colaborador ativo da empresa.
  - Gerenciar Liderados: lista atual, sele√ß√£o e adi√ß√£o de novos, remo√ß√£o individual.
  - Gerenciar Departamentos: lista atual, sele√ß√£o e adi√ß√£o de novos, remo√ß√£o individual.

Valida√ß√µes importantes:

- S√≥ √© poss√≠vel definir como l√≠der um colaborador da mesma empresa.
- Liderados precisam pertencer √† mesma empresa do l√≠der e n√£o podem ser o pr√≥prio l√≠der.
- Departamentos vinculados devem pertencer √† mesma empresa do l√≠der.

Logs:

- Opera√ß√µes cr√≠ticas registradas via `logDatabase` e `logError` (inser√ß√µes/remo√ß√µes em `lider`, `lider_membro`, `lider_departamento`).


---

## üõ†Ô∏è Plano de Corre√ß√µes e Padroniza√ß√£o (Guia de Execu√ß√£o)

Objetivo: organizar, padronizar e eliminar duplicidades para garantir funcionamento est√°vel e consistente em produ√ß√£o.

### 1) API e Integra√ß√£o
- [x] Alinhar Base URL em docs com o projeto (Frontend 3000, Backend 3001, base `/api`).
- [x] Padronizar chamadas protegidas: usar `auth.authenticatedRequest` + `API_CONFIG.BASE_URL` (JWT); manter `EzerAPI` apenas para p√∫blicos.
- [x] Uniformizar respostas `{ success, data, error, message }` nos endpoints principais (Empresas, Colaboradores, Departamentos); ampliar para m√≥dulos restantes conforme ativa√ß√£o.
- [x] `Colaborador.findAll` aceitar `?status=Ativo|Inativo`; padr√£o ‚Äútodos‚Äù (alinhar com Empresas).
- [x] Garantir `empresa_nome` em todas as listagens (JOIN consistente), j√° aplicado em `findAll/findById/findByEmpresa`.

### 2) Backend ‚Äì Regras e Valida√ß√µes
- [x] Centralizar normaliza√ß√£o de datas (yyyy-mm-dd) e strings (trim) nos controllers.
- [x] Validar RF024 (Colaboradores) no create/update (j√° no create): Empresa, CPF, Nome, Data Nascimento, E-mail(s), Telefone, Departamentos, Cargo, Remunera√ß√£o, Data Admiss√£o, Tipo Contrato.
- [x] Reconcilia√ß√£o de `departamentos` no update (j√° aplicada): dif atual vs novo, add/remove com logs.
- [x] Revisar RBAC nas rotas de associa√ß√£o (add/remove) para apenas Empresa/Consultoria (checagem de mesma empresa + permiss√£o).
- [x] Aceitar atualiza√ß√£o parcial sem falhas por campos ausentes (merge e defaults).

### 3) Frontend ‚Äì P√°ginas/Componentes
- [x] Padronizar includes: `config.js`, `auth.js`, `ui.js`, `alerts.js`, `confirm.js`, `app.js` e script do m√≥dulo.
- [x] Migrar p√°ginas para `minimal.css`; descontinuar `style.css` (migrar o que for necess√°rio, remover o restante).
- [x] Spinner (`EzerLoading`) em todas as cargas: listagens, modais, a√ß√µes CRUD (aplicado onde h√° opera√ß√µes; expandir conforme m√≥dulos ganharem listagem padronizada).
- [x] A√ß√µes nas tabelas: Ver/Editar (bot√µes), Inativar/Excluir (√≠cones-only `.btn-icon`) nas p√°ginas padronizadas (Empresas/Colaboradores); expandindo para demais m√≥dulos.
- [x] Reintroduzir Importa√ß√£o de Colaboradores (RF021) com `auth.authenticatedRequest` + toasts `alerts.js`.
- [x] KPI cards com `EzerKPI` onde houver estat√≠sticas (padr√£o Empresas/Colaboradores; aguarda endpoints dos demais m√≥dulos).
- [x] Busca minimalista (√≠cone + debounce) e evitar DataTables nas novas p√°ginas (manteremos um √∫nico padr√£o).

### 4) Frontend ‚Äì Formul√°rios e M√°scaras
- [x] Inputs de data com `type="date"`; m√°scara de data n√£o aplicada a nativos.
- [x] Converter datas para `yyyy-mm-dd` antes de enviar.
- [x] Remunera√ß√£o com m√°scara BRL e convers√£o para decimal no submit (j√° aplicado); formatar visualiza√ß√£o com `R$`.
- [x] Departamentos como checkboxes; enviar `departamentos` no body (backend reconcilia).
- [x] Valida√ß√£o RF024 no front: aplicar `.is-invalid`/`.checkbox-list.invalid` e focar no primeiro erro.

### 5) UI/UX e Estilos
- [x] Consolidar componentes globais: `alerts.js` (toasts), `confirm.js`, `showFormModal`, `showInfoModal`.
- [x] Aplicar `form-grid`, `details-grid`, `kpi-grid`, `.btn-icon`, `.form-select` (seta minimalista) em todas as p√°ginas novas/padronizadas.
- [x] Modais com `max-height: calc(100vh - 80px)` e `overflow: auto` no corpo.
- [x] Favicon padr√£o em todas as p√°ginas.

### 6) Logs e Erros
- [x] Padronizar mensagens de erro no backend; front sempre exibir `showAlert('error', ...)` (fallback `EzerNotifications`).
- [x] Logs claros de opera√ß√µes (`logDatabase`, `logError`) em pontos cr√≠ticos.
- [x] Verificar `/api/health` e adicionar se√ß√£o de troubleshooting (README).

### 7) Documenta√ß√£o
- [x] Atualizar README com fluxos e endpoints reais.
- [x] Atualizar docs de rotas e RBAC com exemplos de payloads.
- [x] Documentar `config.js` e vari√°veis de ambiente esperadas.

### 8) Limpeza
- [x] Remover refer√™ncias a IDs antigos em JS (ex.: `searchInput`, `empresaFilter`, `departamentoFilter`) ‚Äî checadas e removidas; vari√°veis atuais usam checagens seguras e IDs existentes.
- [x] Remover duplicidades em `style.css` e manter apenas `minimal.css` ‚Äî p√°ginas n√£o referenciam `style.css` (mantido apenas para hist√≥rico; n√£o √© carregado).
- [x] Padronizar mecanismo de toasts, manter `EzerNotifications` apenas como fallback ‚Äî ajustado tamb√©m no `dashboard.js`.

---

## Health Check e Troubleshooting

- Health Check da API: `GET /api/health`
  - Resposta exemplo:
  ```json
  { "status": "OK", "timestamp": "2025-10-18T12:00:00.000Z", "uptime": 123.45, "environment": "development" }
  ```
- Problemas comuns e solu√ß√µes:
  - Autentica√ß√£o 401/403: verifique `Authorization: Bearer <token>` e expira√ß√£o do JWT; se necess√°rio, efetue login novamente.
  - CORS: conferir cabe√ßalhos do fetch e origem; backend usa `cors({ origin: true, credentials: true })` em dev.
  - Banco de dados: se `/api/health` OK por√©m opera√ß√µes falham, revisar `.env` no backend (host Azure, SSL habilitado). [[memory:8380388]]
  - Base URL: no frontend, `window.API_CONFIG.BASE_URL` deve apontar para a API correta.

## Configura√ß√£o do Frontend (config.js)

Exemplo de configura√ß√£o esperada no `frontend/public/js/config.js`:
```js
window.API_CONFIG = {
  BASE_URL: 'http://localhost:3001/api'
};
window.FRONTEND_CONFIG = {
  LOGIN_PAGE: '/login-minimal',
  DASHBOARD_URL: '/dashboard-minimal'
};
```

## Exemplos de RBAC e Payloads

- Associa√ß√£o de colaborador a departamento (empresa/consultoria):
  - `POST /api/colaboradores/:id/departamentos`
  - Body: `{ "departamento_id": 12 }`
- Remo√ß√£o de associa√ß√£o:
  - `DELETE /api/colaboradores/:id/departamentos/:departamento_id`
- Atualiza√ß√£o de colaborador com reconcilia√ß√£o de departamentos:
  - `PUT /api/colaboradores/:id`
  - Body (exemplo):
  ```json
  {
    "nome": "Jo√£o Silva",
    "id_empresa": 3,
    "departamentos": [2, 5, 7],
    "data_nascimento": "1990-05-10",
    "data_admissao": "2020-01-15",
    "status": "Ativo"
  }
  ```

### 9) Testes
- [ ] Criar checklist/manual para fluxos principais: Login ‚Üí Empresas (CRUD) ‚Üí Colaboradores (CRUD + Departamentos + Importa√ß√£o) ‚Üí Departamentos.
- [ ] Testar RBAC por perfil.
- [ ] Validar formatos de data e moeda fim-a-fim.

---

### ‚úÖ Ordem sugerida de execu√ß√£o
1. API e integra√ß√£o (authenticatedRequest + API_CONFIG) e documenta√ß√£o.
2. Backend: normaliza√ß√µes, valida√ß√µes (RF024), reconcilia√ß√£o e RBAC.
3. Frontend: migra√ß√£o para `minimal.css`, componentes globais e spinner.
4. Importa√ß√£o de Colaboradores e KPI cards padronizados.
5. Padroniza√ß√£o de tabelas (a√ß√µes) e barra de busca.
6. Testes de RBAC e fluxos e corre√ß√µes finais.


### 3. Registro de ocorr√™ncias
- Data da ocorr√™ncia.
- Classifica√ß√£o: **Positivo**, **Negativo** ou **Neutro**.
- Tipo: Sa√∫de Ocupacional, Aus√™ncia, Carreira (ex.: exame admissional, falta, promo√ß√£o, advert√™ncia).
- Observa√ß√µes detalhadas.

### 4. Registro de treinamentos
- Data inicial e final.
- Categoria: **Online** ou **Presencial**.
- Nome e carga hor√°ria.
- Campo de observa√ß√µes.

### 5. Feedbacks
- Inseridos por **l√≠deres** ou **colaboradores (360¬∞)**.
- Classifica√ß√£o: **Positivo**, **Para Melhorar** ou **Neutro**.
- Campo livre para coment√°rios.
- Acesso limitado conforme rela√ß√£o hier√°rquica:
  - L√≠der ‚Üí liderados
  - Colaborador ‚Üí l√≠der e pares do mesmo departamento

### 6. Avalia√ß√£o de desempenho
- Escalas Likert de 1 a 5 (diferentes perspectivas):
  - **90¬∞:** L√≠der ‚Üí Liderado
  - **180¬∞:** L√≠der ‚Üî Liderado
  - **360¬∞:** L√≠der ‚Üî Liderado + Pares
- Question√°rio personaliz√°vel por empresa.
- Coment√°rio final por avalia√ß√£o.
- **PDI ‚Äì Plano de Desenvolvimento Individual:** gera√ß√£o autom√°tica de plano de a√ß√£o com base nas notas e feedbacks.

### 7. Classifica√ß√£o de usu√°rios e permiss√µes
- **Consultoria:** acesso global a todas as empresas e dados.
- **Cliente (Empresa):**
  - **Administrador:** gerencia colaboradores, departamentos, registros e feedbacks da empresa.
  - **L√≠der:** pode lan√ßar feedbacks e ocorr√™ncias apenas de seus liderados.
  - **Colaborador:** participa das avalia√ß√µes e feedbacks de seus l√≠deres e colegas.

---

## üß± Tecnologias utilizadas

| Camada | Tecnologia |
|--------|------------|
| **Backend** | Node.js (Express) - Porta 3001 |
| **Frontend** | HTML5, CSS3, Bootstrap 5 - Porta 3000 |
| **Banco de Dados** | MySQL |
| **Ambiente** | Azure (Linux VM) |
| **Gerenciador de pacotes** | npm |
| **Execu√ß√£o** | Node / nodemon |
| **Configura√ß√µes** | dotenv |

---

## üìÇ Estrutura de diret√≥rios

```
/ezer_dh
‚îú‚îÄ‚îÄ backend/                          # Backend API (Node.js + Express)
‚îÇ   ‚îú‚îÄ‚îÄ src/                          # C√≥digo fonte da aplica√ß√£o
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app.js                    # Ponto de entrada da aplica√ß√£o
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config/                   # Configura√ß√µes (db, jwt, constantes)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ db.js                 # Configura√ß√£o do banco de dados
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ jwt.js                # Configura√ß√£o JWT
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ constants.js          # Constantes da aplica√ß√£o
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controllers/              # Controllers das rotas
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ authController.js     # Autentica√ß√£o
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ empresaController.js  # Gest√£o de empresas
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ colaboradorController.js # Gest√£o de colaboradores
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ departamentoController.js # Gest√£o de departamentos
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ocorrenciaController.js # Gest√£o de ocorr√™ncias
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ treinamentoController.js # Gest√£o de treinamentos
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ feedbackController.js # Gest√£o de feedbacks
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ avaliacaoController.js # Gest√£o de avalia√ß√µes
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pdiController.js      # Gest√£o de PDI
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models/                   # Modelos do banco de dados
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ consultoria.js        # Modelo da consultoria
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ empresa.js            # Modelo de empresa
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ departamento.js       # Modelo de departamento
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ colaborador.js        # Modelo de colaborador
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ colaboradorDepartamento.js # Rela√ß√£o N:N
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ocorrencia.js         # Modelo de ocorr√™ncia
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ treinamento.js        # Modelo de treinamento
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ feedback.js           # Modelo de feedback
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ avaliacao.js          # Modelo de avalia√ß√£o
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pdi.js                # Modelo de PDI
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes/                   # Defini√ß√£o das rotas
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ authRoutes.js         # Rotas de autentica√ß√£o
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ empresaRoutes.js      # Rotas de empresas
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ colaboradorRoutes.js  # Rotas de colaboradores
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ departamentoRoutes.js # Rotas de departamentos
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ocorrenciaRoutes.js   # Rotas de ocorr√™ncias
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ treinamentoRoutes.js  # Rotas de treinamentos
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ feedbackRoutes.js     # Rotas de feedbacks
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ avaliacaoRoutes.js    # Rotas de avalia√ß√µes
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pdiRoutes.js          # Rotas de PDI
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/                 # L√≥gica de neg√≥cio
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ feedbackService.js    # Servi√ßos de feedback
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ avaliacaoService.js   # Servi√ßos de avalia√ß√£o
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pdiService.js         # Servi√ßos de PDI
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middlewares/              # Middlewares
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ authMiddleware.js     # Middleware de autentica√ß√£o
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ rbacMiddleware.js     # Controle de acesso
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ validationMiddleware.js # Valida√ß√£o de dados
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils/                    # Utilit√°rios
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ logger.js             # Sistema de logs
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ excelImporter.js      # Importa√ß√£o de Excel
‚îÇ   ‚îú‚îÄ‚îÄ public/                       # Arquivos p√∫blicos
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ uploads/                  # Uploads de arquivos
‚îÇ   ‚îú‚îÄ‚îÄ logs/                         # Logs da aplica√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ .env.example                  # Exemplo de vari√°veis de ambiente
‚îÇ   ‚îî‚îÄ‚îÄ package.json                  # Depend√™ncias do backend
‚îÇ
‚îú‚îÄ‚îÄ frontend/                         # Frontend (HTML/CSS/JS + Bootstrap)
‚îÇ   ‚îú‚îÄ‚îÄ src/                          # C√≥digo fonte do frontend
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/               # Componentes reutiliz√°veis
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ navbar.html           # Barra de navega√ß√£o
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ footer.html           # Rodap√©
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cards.html            # Componentes de cards
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/                    # P√°ginas da aplica√ß√£o
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ login-minimal.html    # P√°gina de login (minimal)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dashboard-minimal.html # Dashboard principal (minimal)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ colaboradores.html    # Gest√£o de colaboradores
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ departamentos.html    # Gest√£o de departamentos
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ocorrencias.html      # Gest√£o de ocorr√™ncias
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ treinamentos.html     # Gest√£o de treinamentos
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ feedbacks.html        # Gest√£o de feedbacks
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ avaliacoes.html       # Gest√£o de avalia√ß√µes
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pdi.html              # Gest√£o de PDI
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils/                    # Utilit√°rios do frontend
‚îÇ   ‚îú‚îÄ‚îÄ public/                       # Arquivos p√∫blicos
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index-minimal.html        # P√°gina principal (redirecionamento inteligente)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ css/                      # Estilos CSS
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ js/                       # Scripts JavaScript
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ img/                      # Imagens
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ fonts/                    # Fontes
‚îÇ   ‚îî‚îÄ‚îÄ package.json                  # Depend√™ncias do frontend
‚îÇ
‚îú‚îÄ‚îÄ scripts/                          # Scripts auxiliares
‚îÇ   ‚îî‚îÄ‚îÄ initial.js                    # Script de inicializa√ß√£o
‚îÇ
‚îú‚îÄ‚îÄ database/                         # Arquivos do banco de dados
‚îÇ   ‚îî‚îÄ‚îÄ ezer_dh.sql                   # Script de cria√ß√£o do banco
‚îÇ
‚îú‚îÄ‚îÄ docs/                             # Documenta√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ arquitetura.md                # Documenta√ß√£o de arquitetura
‚îÇ   ‚îú‚îÄ‚îÄ API.md                        # Documenta√ß√£o da API
‚îÇ   ‚îî‚îÄ‚îÄ DEPLOYMENT.md                 # Guia de deploy
‚îÇ
‚îú‚îÄ‚îÄ tests/                            # Testes
‚îÇ   ‚îú‚îÄ‚îÄ unit/                         # Testes unit√°rios
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ backend/                  # Testes do backend
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ frontend/                 # Testes do frontend
‚îÇ   ‚îú‚îÄ‚îÄ integration/                  # Testes de integra√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ e2e/                          # Testes end-to-end
‚îÇ   ‚îú‚îÄ‚îÄ fixtures/                     # Dados de teste
‚îÇ   ‚îú‚îÄ‚îÄ jest.config.js                # Configura√ß√£o do Jest
‚îÇ   ‚îî‚îÄ‚îÄ setup.js                      # Configura√ß√£o dos testes
‚îÇ
‚îú‚îÄ‚îÄ .env.example                      # Exemplo de vari√°veis de ambiente
‚îú‚îÄ‚îÄ .gitignore                        # Arquivos ignorados pelo Git
‚îú‚îÄ‚îÄ package.json                      # Configura√ß√£o do projeto raiz
‚îî‚îÄ‚îÄ README.md                         # Este arquivo
```

---

## ‚öôÔ∏è Configura√ß√£o do ambiente

Antes de come√ßar, copie o arquivo de exemplo de ambiente e ajuste as vari√°veis sens√≠veis. N√£o comite o `.env`.

### 1) Instalar depend√™ncias (backend)
```bash
cd backend
npm install
```

### 2) Arquivo `.env` (exemplo)

As credenciais de conex√£o com o banco devem ser configuradas no arquivo `.env` ‚Äî **n√£o** deixe valores sens√≠veis no reposit√≥rio.

Exemplo:
```
PORT_API=3000
# DB_HOST deve apontar para o host do banco no Azure (n√£o use `localhost` em produ√ß√£o)
DB_HOST=<seu_host_azure_mysql>
DB_USER=<seu_usuario>
DB_PASSWORD=<sua_senha>
DB_NAME=ezer_dh
# Habilite SSL conforme a configura√ß√£o do provedor
DB_SSL=true
```

Observa√ß√£o: o banco de dados do projeto √© hospedado no Azure; nunca instale ou use uma inst√¢ncia local em produ√ß√£o. As credenciais ficam no arquivo `.env` e a conex√£o deve usar SSL quando exigido pelo provedor [[memory:8380388]].

---

## üöÄ Deploy Autom√°tico (GitHub ‚Üí Azure Web App)

Este projeto est√° pronto para deploy cont√≠nuo no Azure Web App a partir do GitHub.

### Pr√©-requisitos
- Um App Service (Azure Web App) criado (Linux) com stack Node.js.
- Publica√ß√£o via perfil de publica√ß√£o (Publish Profile) e Secrets configurados no GitHub.

### 1) Configurar Secrets no GitHub
No reposit√≥rio GitHub, acesse Settings ‚Üí Secrets and variables ‚Üí Actions ‚Üí New repository secret, e adicione:
- `AZURE_WEBAPP_NAME`: Nome do seu Web App (ex.: `ezer-dh-webapp-prod`).
- `AZURE_WEBAPP_PUBLISH_PROFILE`: Conte√∫do do Publish Profile (XML) obtido no Azure Portal: Web App ‚Üí Get publish profile.

### 2) Workflow de Deploy
O arquivo `/.github/workflows/main_ezerdh.yml` j√° est√° adicionado. Ele:
- Faz checkout do c√≥digo.
- Instala depend√™ncias no root, `backend` e `frontend`.
- Cria um artefato `.zip` e publica no Azure Web App.

Branch de deploy: `main`. A cada push na `main`, o Azure far√° o deploy automaticamente.

### 3) App Settings no Azure (Configura√ß√µes de Aplicativo)
No seu Web App (Azure Portal ‚Üí Configuration ‚Üí Application settings), adicione as seguintes chaves:
- `WEBSITE_NODE_DEFAULT_VERSION=18` (ou 20, conforme seu Web App)
- `SCM_DO_BUILD_DURING_DEPLOYMENT=true` (habilita build do Node durante o deploy)
- `NODE_ENV=production`
- `PORT` (opcional; o Azure fornece automaticamente)
- Banco de Dados (com SSL):
  - `DB_HOST=<seu_host_azure_mysql>`
  - `DB_PORT=3306`
  - `DB_USER=<seu_usuario>`
  - `DB_PASSWORD=<sua_senha>`
  - `DB_NAME=ezer_dh`
  - `DB_SSL=true`

### 4) Logs e Health Check
- Health: `GET /api/health` (deve retornar `{ status: "OK" }` etc.).
- Logs: ver `backend/logs`. Ajuste reten√ß√£o conforme necessidade.

### 5) Como funciona em produ√ß√£o
- O backend Express inicia na porta fornecida pelo Azure (`process.env.PORT`).
- Em `production`, o backend serve os arquivos est√°ticos do `frontend/public` e mapeia rotas conhecidas (`/login-minimal`, `/dashboard-minimal`, etc.).
- O frontend usa `window.location.origin` em produ√ß√£o para montar `BASE_URL` da API.

### 6) Troubleshooting
- 403/401: verifique JWT e expira√ß√£o; fa√ßa login novamente.
- Falha ao conectar no MySQL: cheque App Settings do Azure e SSL (`DB_SSL=true`).
- Depend√™ncias ausentes: garanta `SCM_DO_BUILD_DURING_DEPLOYMENT=true` no App Settings; o Oryx far√° o build.
- Node vers√£o: defina `WEBSITE_NODE_DEFAULT_VERSION=18` ou `20`.


## Modelo l√≥gico e tabelas principais

Principais tabelas (resumo):
- clientes (empresas)
- departamentos
- colaboradores
- colaboradores_departamentos (rela√ß√£o N:N)
- ocorrencias
- treinamentos
- feedbacks
- avaliacoes
- pdi
- usuarios
- logs

Relacionamentos principais:
- empresa 1:N departamentos
- empresa 1:N colaboradores
- colaboradores N:N departamentos
- colaboradores 1:N ocorrencias
- colaboradores 1:N treinamentos
- colaboradores N:N feedbacks
- colaboradores N:N avaliacoes

---

## üîê Sistema de Autentica√ß√£o

### Estrutura de Usu√°rios
O sistema utiliza uma **tabela unificada de usu√°rios** (`usuario`) que centraliza a autentica√ß√£o para todos os tipos de usu√°rios:

| Campo | Tipo | Descri√ß√£o |
|-------|------|-----------|
| `id_usuario` | INT | Chave prim√°ria |
| `email` | VARCHAR(255) | Email √∫nico para login |
| `senha` | VARCHAR(255) | Senha criptografada (bcrypt) |
| `tipo_usuario` | ENUM | 'consultoria', 'empresa', 'colaborador' |
| `id_referencia` | INT | ID da tabela espec√≠fica (consultoria, empresa, colaborador) |
| `status` | ENUM | 'Ativo', 'Inativo' |
| `ultimo_login` | TIMESTAMP | Data do √∫ltimo acesso |
| `tentativas_login` | INT | Contador de tentativas falhadas |
| `bloqueado_ate` | TIMESTAMP | Data de desbloqueio (se bloqueado) |

### Fluxo de Autentica√ß√£o
1. **Login**: Usu√°rio informa email/senha
2. **Valida√ß√£o**: Sistema busca na tabela `usuario`
3. **Identifica√ß√£o**: `tipo_usuario` + `id_referencia` define o perfil
4. **Dados**: Sistema busca dados espec√≠ficos na tabela correspondente
5. **Permiss√µes**: RBAC aplicado baseado no `tipo_usuario`

### Seguran√ßa
- **Senhas**: Criptografadas com bcrypt (12 rounds)
- **Tokens**: JWT com expira√ß√£o de 24h
- **Bloqueio**: Ap√≥s 5 tentativas falhidas (30 min)
- **RBAC**: Controle granular por m√≥dulo/a√ß√£o

---

## üß© Etapas do desenvolvimento (resumo)

1. Planejamento funcional
   - Levantamento de requisitos
   - Defini√ß√£o de perfis de usu√°rio e regras de acesso

2. Modelagem do banco de dados
   - Cria√ß√£o do DER
   - Defini√ß√£o de relacionamentos e restri√ß√µes (FKs)
   - Sistema de autentica√ß√£o com tabela `usuario` unificada

3. Arquitetura do projeto
   - Separa√ß√£o por camadas (routes, controllers, models, config)
   - Configura√ß√£o com `dotenv`

4. Desenvolvimento
   - Implementa√ß√£o da API base (Express)
   - Cria√ß√£o das rotas e controllers
   - Implementa√ß√£o da conex√£o e consultas MySQL
   - Integra√ß√£o com frontend

5. Testes e valida√ß√£o
   - Testes unit√°rios e de integra√ß√£o (Jest, Supertest)
   - Testes de usabilidade

6. Deploy e manuten√ß√£o
   - Publica√ß√£o em servidor Azure (Linux)
   - Configura√ß√£o de PM2 / Nginx
   - Monitoramento e logs

---

## üß™ Testes planejados

| Tipo | Descri√ß√£o | Ferramenta |
|------|-----------|-----------|
| Unit√°rio | Teste de fun√ß√µes individuais | Jest |
| Integra√ß√£o | Teste entre m√≥dulos (API ‚Üî DB) | Supertest |
| Usabilidade | Testes com usu√°rios reais | Sess√µes piloto |
| Valida√ß√£o | Cross-check de dados e regras | Scripts automatizados |

---

## üíº Futuras expans√µes

- An√°lise de performance (BI) e dashboards
- Integra√ß√£o com Power BI
- Pesquisas internas (clima organizacional)
- Notifica√ß√µes e relat√≥rios automatizados (e-mail / PDF)

---

## üë• Equipes e pap√©is (resumo)

| Papel | Responsabilidade |
|-------|------------------|
| Consultoria | Administra√ß√£o global e monitoramento |
| Administrador da Empresa | Gest√£o interna de colaboradores e cadastros |
| L√≠der | Inser√ß√£o de feedbacks e avalia√ß√µes dos liderados |
| Colaborador | Participa√ß√£o em avalia√ß√µes 360¬∞ |

---

## üõ°Ô∏è Seguran√ßa e controle de acesso

- Autentica√ß√£o baseada em e-mail corporativo e senha
- Controle de permiss√µes por n√≠vel de usu√°rio
- Logs de atividade em banco
- Separa√ß√£o de dados entre empresas clientes

---

## ‚ö° Execu√ß√£o r√°pida (resumo)

```bash
# Clonar o projeto
git clone https://github.com/seuusuario/ezer_dh.git
cd ezer_dh/backend

# Instalar depend√™ncias
npm install

# Configurar ambiente (copiar e editar .env)
cp .env.example .env

# Executar em modo de desenvolvimento
npm run dev
```

---

## üßæ Licen√ßa

Este projeto √© propriedade intelectual da Ezer Desenvolvimento Humana e n√£o deve ser redistribu√≠do sem autoriza√ß√£o.

---

## üìû Contato

Ezer Desenvolvimento Humano

Desenvolvimento: Paulo Rogg√™

üìß contato@ezerdh.com.br
üåê `https://ezerdh.com.br`
